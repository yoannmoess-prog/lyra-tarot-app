/* src/ChatPage.css */

/* --------- Main Layout --------- */
.page-chat {
  display: flex;
  flex-direction: column;
  height: 100vh;
  max-height: 100vh; /* Pour iOS/Safari */
  overflow: hidden; /* Empêche le body de scroller */
  position: relative;
}

.chat-header {
  position: sticky;
  top: 0;
  z-index: 10;
  height: 64px; /* Rétablissement d'une hauteur fixe sûre */
  flex-shrink: 0;
  /* --- Ajouts pour corriger l'alignement --- */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 16px; /* Ajoute un peu d'air sur les côtés */
  /* --- Annulation de l'effet glassmorphism --- */
  background: transparent !important;
  backdrop-filter: none !important;
  border: none !important;
}

.chat-main {
  flex-grow: 1;
  overflow-y: auto;
  position: relative;
  /* Ajoute un léger espace en haut */
  padding-top: 16px;
  /* --- Effet de fondu aux extrémités --- */
  mask-image: linear-gradient(
    to bottom,
    transparent 0%,
    black 5%,
    black 95%,
    transparent 100%
  );
  -webkit-mask-image: linear-gradient(
    to bottom,
    transparent 0%,
    black 5%,
    black 95%,
    transparent 100%
  );
}

.chat-footer {
  position: sticky;
  bottom: 0;
  z-index: 10;
  background: transparent;
  flex-shrink: 0;
  transition: opacity 0.4s ease, transform 0.4s ease;
  opacity: 0;
  transform: translateY(10px);
}
.chat-footer.show {
  opacity: 1;
  transform: translateY(0);
}

.chat-body {
  display: flex;
  flex-direction: column;
  justify-content: flex-end; /* Aligne le contenu en bas */
  min-height: 100%;
  /* Utilise une variable pour le padding, synchronisée par JS */
  padding-bottom: var(--footer-h, 90px);
  /* Indique au navigateur où arrêter le défilement */
  scroll-padding-bottom: var(--footer-h, 90px);
  /* --- Ajout pour centrer et limiter la largeur --- */
  width: 100%;
  max-width: min(900px, 92vw);
  margin: 0 auto;
  box-sizing: border-box; /* S'assure que le padding ne s'ajoute pas à la largeur */
  /* --- Ajout du padding latéral --- */
  padding-left: 12px;
  padding-right: 12px;
}

/* --------- Messages Layout --------- */
.messages {
  display: flex;
  flex-direction: column;
  gap: 10px; /* Espace vertical entre les bulles */
}

/* --------- Tarot Rail Layout --------- */
.chat-rail {
  /* Le padding supérieur a été réduit pour un espace plus harmonieux */
  padding: 16px 0 48px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  /* Un min-height pour éviter les sauts de layout au chargement */
  min-height: 250px;
}

.final-rail {
  display: flex;
  justify-content: center;
  gap: clamp(8px, 3vw, 30px); /* Espacement dynamique avec un max de 30px */
  width: 100%;
  margin: 0 auto;
  box-sizing: border-box;
}

.final-card-outer {
  flex: 1 1 0; /* Permet aux cartes de grandir et rétrécir */
  max-width: 160px; /* Une largeur maximale raisonnable pour les cartes */
  min-width: 80px; /* Empêche les cartes de devenir trop petites */
  aspect-ratio: 9.27 / 18; /* Conserve les proportions de la carte */
  box-sizing: border-box;
}

/* --------- Rail-Truth Specific Layout --------- */
/*
  Ce layout spécifique est appliqué à la fois sur la page
  principale (.page-chat) et dans la modale.
*/
.rail-truth {
  /* Pas de style spécifique nécessaire avec flexbox, l'alignement est déjà géré. */
}

/*
  On cible directement la carte en position B pour la décaler.
  L'utilisation de `data-pos` est plus robuste que `:nth-child`.
*/
.rail-truth > [data-pos='B'] {
  transform: translateY(50%);
}

/*
  Sur la page principale uniquement, on ajoute une marge en bas du rail
  pour laisser de la place à la conversation.
*/
.page-chat .rail-truth {
  --rail-gap: 160px; /* Espace vertical ajustable */
  margin-bottom: var(--rail-gap);
}

/*
  Pour le tirage vérité, on ajoute une contrainte de hauteur pour éviter
  le débordement vertical sur les écrans courts (ex: mobile en paysage).
  La hauteur du rail est d'environ 1.5x la hauteur d'une carte.
  La hauteur de la carte est de ~1.94x sa largeur.
  On peut donc calculer la largeur max de la carte à partir de la hauteur du viewport.
  (100svh - paddings) / 1.5 / 1.94
  Ce qui donne une largeur max d'environ 25svh. On prend une valeur sûre.
*/
@media (max-height: 500px) {
  .rail-truth .final-card-outer {
    max-width: 22svh;
  }
}

/* Force rebuild */
