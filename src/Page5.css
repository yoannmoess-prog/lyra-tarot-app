/* src/Page5.css — final grid 3 cartes, chat, VOUS+CTA simplifiés */

/* Fades */
.fade-in-soft  { opacity: 1; transform: translateY(0) scale(1); transition: opacity .6s ease, transform .6s ease; }
.pre-fade { opacity: 0; transform: translateY(6px) scale(.985); }

/* Root */
.page5-root{
  overscroll-behavior-y: contain;
  min-height: 100vh;
  background-size: cover;
  background-position: center;
  background-attachment: fixed; /* <-- FIX: zoomed background */
}
@supports (height: 100svh){ .page5-root{ min-height: 100svh; } }

/* --- Title copied from Page4 --- */
.title-block {
  width: 100%; /* <-- FIX: s'assurer que le titre peut se centrer */
  text-align: center;
  color: #F8F5E1;
  font-family: 'Sorts Mill Goudy', serif;
  opacity: 0; /* for fade-in */
  animation: finalAppear 1.2s ease .2s forwards; /* reuse same anim, with delay */
}
.p4-fixed-title {
  font-size: clamp(1.6rem, 3vw, 2.4rem);
  line-height: 1.25;
  margin-bottom: 0.5em;
}

/* --- Bloc final défilant --- */
.final-stack{
  max-width: min(1100px, 94vw);
  margin: 0 auto;
  padding: 9vh clamp(16px,4vw,56px) 8vh;
  display: grid;
  gap: clamp(18px, 3.5vw, 28px);
}

/* Cartes finales — GRID 3 pour ne jamais se toucher */
.final-hero{
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}
.final-rail{
  width: 100%;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  justify-items: center;
  align-items: start;
  gap: 24px; /* MODIF: Espacement fixe entre les cartes */
  opacity: 0;
}

/* Apparition lente (2s) des 3 grandes cartes */
.appear-slow{ animation: finalAppear 2s ease forwards; }
@keyframes finalAppear{ from { opacity: 0; transform: scale(.985); } to { opacity: 1; transform: scale(1); } }

/* Glow héroïque après flips */
.final-rail.sealed .final-card-flip .final-front{
  animation: cardGlowHero .95s ease-out both;
}
@keyframes cardGlowHero{
  0%   { box-shadow: 0 0 0 rgba(255,255,255,0); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
  35%  { box-shadow: 0 0 90px rgba(255,255,255,0.98); filter: drop-shadow(0 0 62px rgba(255,255,255,0.98)); }
  100% { box-shadow: 0 14px 34px rgba(0,0,0,.58); filter: none; }
}

/* Taille constante dos/face + responsive safe */
.final-card-outer{
  display: flex;
  flex-direction: column;
  align-items: center;
  width: min(28vw, 26vh, 200px);
  perspective: 1100px;
  justify-self: center;
}
.final-card-flip{
  position: relative;
  width: 100%;
  aspect-ratio: 9.27 / 16;
  transform-style: preserve-3d;
  transition: transform .62s cubic-bezier(.2,.7,.2,1);
}
.final-card-flip.is-flipped{ transform: rotateY(180deg); }
.final-face{
  position:absolute;
  inset:0;
  border-radius:14px;
  backface-visibility:hidden;
  box-shadow:0 8px 18px rgba(0,0,0,.33);
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
}
.final-back{
  background-image: url("./assets/desk_01.png");
  background-size:110% 110%;
}
.final-front{
  transform: rotateY(180deg);
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(15,15,15,.18);
  border: 1px solid rgba(248,245,225,.12);
  position: relative;
  overflow: hidden;
}
.final-front > img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display:block;
  border-radius: inherit;
}
.final-front::before{
  content:"";
  position:absolute;
  inset:-10%;
  background: linear-gradient(100deg, rgba(255,255,255,.12), rgba(255,255,255,0) 60%);
  transform: translateX(-120%) skewX(-12deg);
  filter: blur(1px);
}
.final-card-flip.is-flipped .final-front::before{ animation: foldSweep .62s cubic-bezier(.2,.7,.2,1) both; }
@keyframes foldSweep{
  0%   { transform: translateX(-120%) skewX(-12deg); opacity:.85; }
  55%  { transform: translateX(0%)    skewX(-12deg); opacity:.35; }
  100% { transform: translateX(120%)  skewX(-12deg); opacity:0; }
}

/* Légendes sous les cartes */
.final-caption{
  margin-top: 1.2em;
  font-family:'Sorts Mill Goudy', serif;
  font-size: clamp(0.85rem, 1.2vw, 1.1rem);
  line-height: 1.3;
  color:#F8F5E1;
  opacity: 0;
  transform: translateY(-2px);
  transition: opacity .35s ease .15s, transform .35s ease .15s;
  pointer-events: none;
  padding-top: 2px;
}
.final-card-flip.is-flipped + .final-caption{
  opacity: 1;
  transform: translateY(0);
}

/* --- Chat : alignements fermes à gauche/droite --- */
.chat-wrap{
  width: 100%;
  max-width: min(900px, 92vw);
  margin: 0 auto;
  padding: 12px 8px max(env(safe-area-inset-bottom), 40px);
  display:flex;
  flex-direction: column;
  gap: 10px;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity .5s ease, transform .5s ease;
  text-align: left;
  align-items: flex-start;
}
.chat-wrap.show{ opacity: 1; transform: translateY(0); }

.lyra-fadein {
  animation: fadeInSoft 0.8s ease;
}
@keyframes fadeInSoft {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.you-fadein {
  animation: fadeInSoft 0.5s ease; /* Plus rapide pour la bulle utilisateur */
}

.bubble{
  max-width: 78%;
  padding: 10px 14px;
  border-radius: 18px;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  line-height: 1.35;
  position: relative;
  color: #101112;
  background: #E9EDF2;
  border: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 2px 10px rgba(0,0,0,.12);
  text-align: left;
}
.bubble .who{
  font-weight: 800;
  letter-spacing:.06em;
  text-transform: uppercase;
  margin: 0 0 4px;
  font-size: .78rem;
  opacity: .7;
}

.bubble.lyra{
  align-self: flex-start;
  border-top-left-radius: 0;
}
.bubble.you{
  align-self: flex-end;
  border-top-right-radius: 0;
  overflow: hidden;
}

/* Bloc commun VOUS + CTA */
.you-block{
  /* MODIF: Centré comme chat-wrap, pour aligner le contenu à droite */
  max-width: min(900px, 92vw);
  margin: 0 auto;
  padding-bottom: max(env(safe-area-inset-bottom), 24px);

  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* Aligne les enfants (bulle + CTAs) à droite */
  gap: 8px;
  opacity: 0;
  transform: translateY(6px);
}
.you-block > *{
  /* MODIF: Laisser les enfants déterminer leur propre largeur, sans forcer 100% */
  max-width: 100%;
  box-sizing: border-box;
}
.you-block.show{
  opacity: 1;
  transform: translateY(0);
  transition: opacity 600ms ease, transform 600ms ease;
}
.you-block .bubble.you{
  /* MODIF: La bulle d'input ne prend plus toute la largeur et correspond aux autres bulles */
  width: 100%;
  max-width: 78%;
}

/* Formulaire de réponse */
.you-form{
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
}
.you-input{
  flex: 1 1 auto;
  min-width: 0;
  width: 100%;
  box-sizing: border-box;
  font-family:'Sorts Mill Goudy', serif !important;
  font-weight: 400;
  font-size: 1rem;
  border: 1px solid rgba(0,0,0,.12);
  border-radius: 12px;
  padding: 10px 12px;
  outline: none;
  background: #fff;
  color: #111;
  padding-right: 46px;
}
.you-input::placeholder{
  color: #666;
  font-family:'Sorts Mill Goudy', serif !important;
  font-weight: 400;
}
.send-btn{
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 36px;
  height: 36px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0;
  border: 0;
  background: transparent;
  box-shadow: none;
  outline: none;
  cursor: pointer;
  color: #111;
}
.send-btn .material-symbols-outlined{ font-size: 22px; line-height: 1; display: block; }

/* CTA Block */
.cta-block {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  width: 100%;
  margin-top: 12px;
}

/* CTA Buttons (inspired by Page3.css) */
.cta-btn {
  background: transparent;
  border: 1px solid #E0E0CF;
  color: #E0E0CF;
  font-family: 'Sorts Mill Goudy', serif;
  border-radius: 22px;
  padding: 10px 16px;
  font-size: clamp(0.9rem, 1.4vw, 1.1rem);
  line-height: 1.4;
  cursor: pointer;
  transition: background 180ms ease, color 180ms ease;
  width: fit-content;
  max-width: 100%;
  text-align: right;
}
.cta-btn:hover {
  background: rgba(224, 224, 207, 0.1);
  color: #F5F3DA;
}

/* CTA nouveau tirage (style harmonisé) */
.newdraw-btn {
  /* Harmonisation avec .cta-btn */
  background: rgba(255, 255, 255, 0.08); /* Fond blanc léger pour distinction */
  border: 1px solid #E0E0CF;
  color: #E0E0CF;
  font-family: 'Sorts Mill Goudy', serif;
  border-radius: 22px;
  padding: 10px 16px;
  font-size: clamp(0.9rem, 1.4vw, 1.1rem);
  line-height: 1.4;
  cursor: pointer;
  transition: background 180ms ease, color 180ms ease;
  width: fit-content;
  max-width: 100%;
  text-align: center;
  margin-top: 12px;
  box-shadow: none;
}

.newdraw-btn:hover {
  background: rgba(224, 224, 207, 0.2); /* Un peu plus visible */
  color: #F5F3DA;
}

.newdraw-btn:focus,
.newdraw-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px rgba(224, 224, 207, 0.7); /* Ombre de focus assortie */
}

.bubble .msg p{
  font-family: 'Sorts Mill Goudy', serif !important;
  font-weight: 400;
}

/* Bulle "LYRA tape…" */
.bubble.typing .dots{
  display: inline-flex;
  gap: 6px;
  padding: 4px 2px 2px 2px;
}
.bubble.typing .dots span{
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #333;
  opacity: .2;
  animation: dotBlink 1.2s infinite ease-in-out;
}
.bubble.typing .dots span:nth-child(2){ animation-delay: .2s; }
.bubble.typing .dots span:nth-child(3){ animation-delay: .4s; }
@keyframes dotBlink{
  0%, 20% { opacity: .2; transform: translateY(0); }
  50%     { opacity: 1;  transform: translateY(-2px); }
  100%    { opacity: .2; transform: translateY(0); }
}

@media (prefers-reduced-motion: reduce){
  * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; }
}

@media (max-width:520px){
  .final-card-outer{ width:min(30vw, 26vh, 156px); }
}