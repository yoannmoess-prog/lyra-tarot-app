/* src/Page5.css — final grid 3 cartes, chat, VOUS+CTA simplifiés */

/* Fades */
.fade-in-soft { opacity: 1; transform: translateY(0) scale(1); transition: opacity .6s ease, transform .6s ease; }
.pre-fade { opacity: 0; transform: translateY(6px) scale(.985); }

/* Root layout: Flex column pour Header / Main / Footer */
.page5-root {
  overscroll-behavior-y: contain;
  height: 100vh; /* Fallback */
  height: 100svh; /* Précis sur mobile */
  display: flex;
  flex-direction: column;
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
}

/* --- Header Fixe --- */
.page5-header {
  flex-shrink: 0; /* Empêche le header de rétrécir */
  padding: clamp(20px, 4vh, 30px) clamp(16px, 4vw, 56px); /* Hauteur augmentée */
  color: #F8F5E1;
  text-align: center;
  background: transparent; /* Fond supprimé */
  backdrop-filter: blur(24px); /* Flou plus intense */
  -webkit-backdrop-filter: blur(24px);
  border-bottom: 1px solid rgba(248, 245, 225, 0.1);
  box-shadow: 0 2px 12px rgba(0,0,0,0.25);
  opacity: 0;
  animation: finalAppear 1.2s ease .2s forwards;
  z-index: 10;
}
.page5-header {
  position: relative;
  pointer-events: none; /* Le header ignore les clics */
  /* La hauteur est déterminée par le padding + la hauteur de ligne du titre */
}

.p5-fixed-title {
  font-family: var(--font-serif);
  font-size: clamp(1.05rem, 2.5vw, 1.3rem);
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: auto; /* Le titre redevient cliquable */

  /* Centrage absolu pour éviter les interférences */
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  max-width: calc(100% - 120px); /* Laisse 60px de chaque côté */
}

.header-icon-container {
  position: absolute;
  right: clamp(12px, 3vw, 20px);
  top: 50%;
  transform: translateY(-50%);
  opacity: 0;
  pointer-events: none; /* Reste non-cliquable par défaut */
  transition: opacity 0.4s ease;
  z-index: 2; /* Au-dessus du titre pour être sûr */
}
.header-icon-container.show {
  opacity: 1;
  pointer-events: auto; /* Le conteneur redevient cliquable quand il est visible */
}
.header-icon-btn {
  background: transparent;
  border: none;
  color: #F8F5E1;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
}
.header-icon-btn:hover {
  background-color: rgba(255, 255, 255, 0.1);
}
.header-icon-btn .ms-icon {
  font-size: 28px;
}

/* Styles pour la modale du tirage */
.spread-modal-container {
  width: 100%;
  max-width: min(1100px, 94vw);
  padding: clamp(24px, 5vh, 48px) clamp(16px,4vw,56px);
}
.spread-modal-container .final-rail {
  opacity: 1; /* S'assurer que le tirage est visible */
  gap: 16px; /* Ajout d'un gap pour espacer les cartes */
}

@media (max-width: 520px) {
  .spread-modal-container .final-rail {
    gap: 8px; /* Gap plus petit pour mobile */
  }
  .spread-modal-container .final-card-outer {
    width: min(28vw, 24vh, 140px); /* Taille des cartes réduite pour la modale mobile */
  }
}

/* --- Contenu principal défilable --- */
.page5-main-scroll {
  flex-grow: 1; /* Prend toute la place restante */
  overflow-y: auto;
  overscroll-behavior-y: contain;
}

/* --- Bloc de contenu (cartes + chat) --- */
.final-stack {
  max-width: min(1100px, 94vw);
  margin: 0 auto;
  padding: clamp(24px, 5vh, 48px) clamp(16px,4vw,56px);
  display: grid;
  gap: clamp(18px, 3.5vw, 28px);
}

/* Apparition lente globale */
@keyframes finalAppear { from { opacity: 0; transform: scale(.985); } to { opacity: 1; transform: scale(1); } }

/* Cartes finales — GRID 3 pour ne jamais se toucher */
.final-hero {
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}
.final-rail {
  width: 100%;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  justify-items: center;
  align-items: start;
  gap: 24px;
  opacity: 0;
}
.appear-slow { animation: finalAppear 2s ease forwards; }

/* ... (styles des cartes inchangés) ... */
.final-rail.sealed .final-card-flip .final-front{ animation: cardGlowHero .95s ease-out both; }
@keyframes cardGlowHero{
  0%   { box-shadow: 0 0 0 rgba(255,255,255,0); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
  35%  { box-shadow: 0 0 90px rgba(255,255,255,0.98); filter: drop-shadow(0 0 62px rgba(255,255,255,0.98)); }
  100% { box-shadow: 0 14px 34px rgba(0,0,0,.58); filter: none; }
}
.final-card-outer{ display: flex; flex-direction: column; align-items: center; width: min(28vw, 26vh, 200px); perspective: 1100px; justify-self: center; }
.final-card-flip{ position: relative; width: 100%; aspect-ratio: 9.27 / 16; transform-style: preserve-3d; transition: transform .62s cubic-bezier(.2,.7,.2,1); }
.final-card-flip.is-flipped{ transform: rotateY(180deg); }
.final-face{ position:absolute; inset:0; border-radius:14px; backface-visibility:hidden; box-shadow:0 8px 18px rgba(0,0,0,.33); background-size:cover; background-position:center; background-repeat:no-repeat; }
.final-back{ background-image: url("./assets/desk_01.png"); background-size:110% 110%; }
.final-front{ transform: rotateY(180deg); display:flex; align-items:center; justify-content:center; background: rgba(15,15,15,.18); border: 1px solid rgba(248,245,225,.12); position: relative; overflow: hidden; }
.final-front > img{ width: 100%; height: 100%; object-fit: cover; display:block; border-radius: inherit; }
.final-front::before{ content:""; position:absolute; inset:-10%; background: linear-gradient(100deg, rgba(255,255,255,.12), rgba(255,255,255,0) 60%); transform: translateX(-120%) skewX(-12deg); filter: blur(1px); }
.final-card-flip.is-flipped .final-front::before{ animation: foldSweep .62s cubic-bezier(.2,.7,.2,1) both; }
@keyframes foldSweep{
  0%   { transform: translateX(-120%) skewX(-12deg); opacity:.85; }
  55%  { transform: translateX(0%)    skewX(-12deg); opacity:.35; }
  100% { transform: translateX(120%)  skewX(-12deg); opacity:0; }
}
.final-caption{ margin-top: 1.2em; font-family:'Sorts Mill Goudy', serif; font-size: clamp(0.85rem, 1.2vw, 1.1rem); line-height: 1.3; color:#F8F5E1; opacity: 0; transform: translateY(-2px); transition: opacity .35s ease .15s, transform .35s ease .15s; pointer-events: none; padding-top: 2px; }
.final-card-flip.is-flipped + .final-caption{ opacity: 1; transform: translateY(0); }

/* --- Chat --- */
.chat-wrap {
  width: 100%;
  max-width: min(900px, 92vw);
  margin: 0 auto;
  padding: 12px 8px; /* Padding bottom géré par le footer */
  display:flex;
  flex-direction: column;
  gap: 10px;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity .5s ease, transform .5s ease;
  text-align: left;
  align-items: flex-start;
}
.chat-wrap.show { opacity: 1; transform: translateY(0); }

.lyra-fadein { animation: fadeInSoft 0.8s ease; }
@keyframes fadeInSoft { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.you-fadein { animation: fadeInSoft 0.5s ease; }

.bubble { max-width: 78%; padding: 10px 14px; border-radius: 18px; font-family: var(--font-sans); line-height: 1.35; position: relative; color: #101112; background: #E9EDF2; border: 1px solid rgba(0,0,0,.06); box-shadow: 0 2px 10px rgba(0,0,0,.12); text-align: left; }

@media (min-width: 961px) {
  .bubble { max-width: 50%; }
}
.bubble .who { font-family: var(--font-serif); font-weight: 400; letter-spacing:.03em; text-transform: uppercase; margin: 0 0 4px; font-size: .8rem; opacity: .8; }
.bubble.lyra { align-self: flex-start; border-top-left-radius: 0; }
.bubble.lyra .msg p { color: #1E1E1E; }
.bubble.you { align-self: flex-end; border-top-right-radius: 0; overflow: hidden; background-color: #0A1B36; border-color: rgba(255,255,255,0.2); }
.bubble.you .msg p { color: #FFFFFF; }
.bubble.you .who { color: #FFFFFF; opacity: 0.7; }
.bubble .msg p { font-family: var(--font-sans) !important; font-weight: 400; }
.bubble.typing .dots { display: inline-flex; gap: 6px; padding: 4px 2px 2px 2px; }
.bubble.typing .dots span { width: 6px; height: 6px; border-radius: 50%; background: #333; opacity: .2; animation: dotBlink 1.2s infinite ease-in-out; }
.bubble.typing .dots span:nth-child(2) { animation-delay: .2s; }
.bubble.typing .dots span:nth-child(3) { animation-delay: .4s; }
@keyframes dotBlink { 0%, 20% { opacity: .2; transform: translateY(0); } 50% { opacity: 1;  transform: translateY(-2px); } 100% { opacity: .2; transform: translateY(0); } }

/* --- Footer Fixe --- */
.page5-footer {
  flex-shrink: 0; /* Empêche le footer de rétrécir */
  z-index: 10;
  opacity: 0;
  transform: translateY(100%);
  transition: opacity 400ms ease-in-out, transform 400ms ease-in-out;
  background: transparent;
  padding-top: 4px; /* Espace au-dessus du you-block */
}
.page5-footer.show {
  opacity: 1;
  transform: translateY(0);
}

/* Bloc "VOUS" dans le footer */
.you-block {
  max-width: min(900px, 92vw);
  margin: 0 auto;
  padding: 8px 8px max(env(safe-area-inset-bottom), 12px);
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
}
.you-block > * {
  max-width: 100%;
  box-sizing: border-box;
}
.you-block .bubble.you {
  width: 100%;
  max-width: 100%; /* La bulle prend toute la largeur du container .you-block */
}

/* Formulaire de réponse */
.you-form { position: relative; display: flex; align-items: center; width: 100%; }
.you-input {
  flex: 1 1 auto;
  min-width: 0;
  width: 100%;
  box-sizing: border-box;
  font-family: var(--font-sans);
  font-weight: 400;
  font-size: 1rem;
  border: 1px solid rgba(248, 245, 225, 0.2);
  border-radius: 18px; /* Match des bulles de chat */
  padding: 10px 46px 10px 16px;
  outline: none;
  background: rgba(248, 245, 225, 0.1); /* Fond très subtil */
  color: #F8F5E1;
  transition: border-color .2s ease, background-color .2s ease;
}
.you-input:focus {
  background: rgba(248, 245, 225, 0.15);
  border-color: rgba(248, 245, 225, 0.4);
}
.you-input::placeholder { color: rgba(248, 245, 225, 0.5); font-family: var(--font-sans); font-weight: 400; }
.send-btn { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; padding: 0; margin: 0; border: 0; background: transparent; box-shadow: none; outline: none; cursor: pointer; color: #F8F5E1; opacity: 0.8; transition: opacity .2s ease; }
.send-btn:hover { opacity: 1; }
.send-btn .material-symbols-outlined { font-size: 24px; line-height: 1; display: block; }

/* --- Media Queries --- */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; }
}
/* Styles pour la carte zoomée dans la modale */
.zoomed-card-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.zoomed-card-img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: clamp(60vh, 80vh, 85vh); /* Prend une bonne partie de la hauteur */
  object-fit: contain;
  border-radius: 14px;
  box-shadow: 0 14px 45px rgba(0,0,0,0.4);
}

/* Pour le "pinch-to-zoom" sur mobile */
@media (max-width: 768px) {
  .zoomed-card-container {
    overflow: auto; /* Permet de pincer pour zoomer */
    -webkit-overflow-scrolling: touch; /* Défilement fluide sur iOS */
  }
  .zoomed-card-img {
    height: auto; /* La hauteur s'adapte au zoom */
    min-width: 100%; /* L'image prend au moins la largeur du conteneur */
  }
}

@media (max-width:520px) {
  .final-card-outer { width:min(30vw, 26vh, 156px); }
  .p5-fixed-title { font-size: 1rem; }
}